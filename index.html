<!doctype html>
<html lang="sk">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cievny.sk – public insert test</title>
  <body style="font-family:system-ui;max-width:720px;margin:40px auto;padding:0 16px;">
    <h1>Test zápisu bez prihlásenia</h1>

    <section style="margin:24px 0;padding:16px;border:1px solid #ddd;border-radius:8px">
      <h2 style="margin-top:0">Nový pacient (sandbox)</h2>
      <input id="pseudo" placeholder="PSEUDO-ID (napr. PSEUDO-001)"
             style="width:100%;padding:10px;margin:6px 0" />
      <select id="sex" style="width:100%;padding:10px;margin:6px 0">
        <option value="M">M</option><option value="F">F</option><option value="X">X</option>
      </select>
      <input id="yob" type="number" placeholder="Rok narodenia (napr. 1979)"
             style="width:100%;padding:10px;margin:6px 0" />
      <button id="save">Uložiť pacienta</button>
      <div id="msg" style="margin-top:10px;color:#0a0"></div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      const SUPABASE_URL  = "https://ktdvgmwrqwznuikehpmk.supabase.co";
      const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0ZHZnbXdycXd6bnVpa2VocG1rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMzg3MTUsImV4cCI6MjA3MDYxNDcxNX0.2YvdIUC41fYsXsT_zJyf2VKvOi2obsJ27fRewQEajmE";
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

      document.getElementById('save').onclick = async () => {
        const pseudo = document.getElementById('pseudo').value.trim();
        const sex    = document.getElementById('sex').value;
        const yob    = Number(document.getElementById('yob').value);

        if (!pseudo) { alert("Vyplň PSEUDO‑ID."); return; }

        const { error } = await supabase.from('patient')
          .insert({ pseudo_id: pseudo, sex, yob /* created_by: NULL */ });

        const msg = document.getElementById('msg');
        msg.textContent = error ? ("Chyba: " + error.message) : "Uložené ✅ – pozri tabuľku patient v Supabase.";
        msg.style.color = error ? '#b00' : '#0a0';
      };
    </script>
  </body>
</html>