<section style="margin:24px 0;padding:16px;border:1px solid #ddd;border-radius:8px">
  <h2 style="margin-top:0">Prihlásenie</h2>

  <div style="display:grid;gap:8px;max-width:460px">
    <input id="email" type="email" placeholder="tvoj@email.sk" style="padding:10px" />
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button id="sendLink">Pošli magic link</button>
      <input id="pwd" type="password" placeholder="Heslo (len ak máš vytvorené)" style="padding:10px;flex:1 1 180px" />
      <button id="signinPwd">Prihlásiť heslom</button>
      <button id="signout" style="margin-left:auto;display:none">Odhlásiť</button>
    </div>
    <div id="whoami" style="color:#555">Neprihlásený</div>
    <div id="authMsg" style="color:#b00"></div>
  </div>
</section>

<script>
// ---- Supabase klient (ponechaj tvoje URL/ANON) ----
const SUPABASE_URL = "https://ktdvgmwrqwznuikehpmk.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0ZHZnbXdycXd6bnVpa2VocG1rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMzg3MTUsImV4cCI6MjA3MDYxNDcxNX0.2YvdIUC41fYsXsT_zJyf2VKvOi2obsJ27fRewQEajmE";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

const who = document.getElementById('whoami');
const out = document.getElementById('signout');
const msg = document.getElementById('authMsg');

async function refreshUser() {
  const { data: { user }, error } = await supabase.auth.getUser();
  if (error) { msg.textContent = "Auth error: " + error.message; return; }
  if (user) { who.textContent = "Prihlásený: " + (user.email || user.id); out.style.display = 'inline-block'; msg.textContent = ""; }
  else { who.textContent = "Neprihlásený"; out.style.display = 'none'; }
}

document.getElementById('sendLink').onclick = async () => {
  msg.textContent = "";
  const email = document.getElementById('email').value.trim();
  const { error } = await supabase.auth.signInWithOtp({
    email,
    options: { emailRedirectTo: window.location.origin }
  });
  msg.style.color = error ? '#b00' : '#0a0';
  msg.textContent = error ? ("Chyba: " + error.message) : "Odošiel magic link. Otvor ho v Safari.";
};

document.getElementById('signinPwd').onclick = async () => {
  msg.textContent = "";
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('pwd').value;
  const { error } = await supabase.auth.signInWithPassword({ email, password });
  msg.style.color = error ? '#b00' : '#0a0';
  msg.textContent = error ? ("Heslové prihlásenie zlyhalo: " + error.message) : "Prihlásený (heslo).";
  await refreshUser();
};

document.getElementById('signout').onclick = async () => { await supabase.auth.signOut(); await refreshUser(); };

refreshUser();
supabase.auth.onAuthStateChange(refreshUser);
</script>